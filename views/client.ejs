<!doctype html>
<html lang="en">

  <%- include('header'); -%>

  <div class="container">

    <div id="game">
      <div v-if="connected">

        <div v-if="!loggedIn" class="auth-wrapper">
          <div class="auth-card">

            <div class="logo-wrap">
              <img src="/static/quiplash-logo.png"
                   alt="Quiplash Logo"
                   class="game-logo">
            </div>

            <p v-if="errorMessage" 
               class="message-text"
               :class="{ 'error-text': !isPositiveMessage, 'positive-text': isPositiveMessage }">
              {{ errorMessage }}
            </p>

            <div class="form-group">
              <input type="text"
                     class="form-control"
                     v-model="username"
                     placeholder="Enter your username">
            </div>

            <div class="form-group">
              <input type="password"
                     class="form-control"
                     v-model="password"
                     placeholder="Enter your password">
            </div>

            <div class="form-group button-row">
              <button class="btn btn-primary" @click="login">Login</button>
              <button class="btn btn-secondary" @click="register">Register</button>
            </div>
          </div>
        </div>

        <div v-else class="game-wrapper">

          <p v-if="errorMessage" 
             class="message-text"
             :class="{ 'error-text': !isPositiveMessage, 'positive-text': isPositiveMessage }">
            {{ errorMessage }}
          </p>

          <p v-if="gameState && gameState.stage !== 'PROMPTS'" class="stage-indicator">
            Stage: <strong>{{ gameState.stage }}</strong>
            <span v-if="gameState.round">&nbsp;¬∑ Round {{ gameState.round }}</span>
          </p>

          <div v-if="gameState && gameState.stage === 'JOINING'" class="game-stage-wrapper">

            <div class="lobby-card">
              <div class="lobby-header">
                <img src="/static/quiplash-logo.png"
                     alt="Quiplash Logo"
                     class="game-logo small-logo">
                <h3 class="lobby-title">LOBBY</h3>
              </div>

              <p class="lobby-subtitle">
                Hi **{{ username }}**, you‚Äôre in!
              </p>

              <p class="lobby-text">
                Waiting for other players to join‚Ä¶ When the host starts the game, your prompts
                and answers will appear here.
              </p>

              <p class="lobby-hint">
                Keep this tab open. You can chat with everyone in the lobby below.
              </p>

              <div class="lobby-list" v-if="gameState.players && gameState.players.length">
                <h5 class="lobby-list-title">
                  Players ({{ gameState.players.length }}/4)
                </h5>
                <ul class="lobby-list-ul">
                  <li v-for="p in gameState.players" :key="p.id">
                    <span class="lobby-player-name">
                      {{ p.username }}
                      <span v-if="p.isAdmin">üëë</span>
                      <span v-if="p.username === username"> (you)</span>
                    </span>
                  </li>
                </ul>
              </div>

              <div class="lobby-list" v-if="gameState.audience && gameState.audience.length">
                <h5 class="lobby-list-title">
                  Audience ({{ gameState.audience.length }})
                </h5>
                <ul class="lobby-list-ul">
                  <li v-for="a in gameState.audience" :key="a.id">
                    <span class="lobby-player-name">
                      {{ a.username }}
                    </span>
                  </li>
                </ul>
              </div>

              <div v-if="isAdmin" class="lobby-admin-controls">
                <button class="btn btn-primary" @click="next">
                  Start game / Next
                </button>
                <p class="admin-hint">
                  You are the host. Tap this when everyone‚Äôs ready.
                </p>
              </div>
            </div>

            <div class="chat-card">
              <h4 class="chat-title">Lobby Chat</h4>

              <div class="form-group">
                <input type="text"
                       @keyup.enter="chat()
                       "
                       v-model="chatmessage"
                       class="form-control"
                       placeholder="Type a message and press Enter">
              </div>

              <div class="form-group">
                <button class="btn btn-primary" @click="chat">Send</button>
              </div>

              <ul id="chat">
                <li v-for="(m, idx) in messages"
                    :key="idx"
                    :class="['chat-message', { 'my-message': m.username === username }]">

                  <div class="chat-header">
                    <div class="chat-avatar">
                      {{ (m.username || '?')[0].toUpperCase() }}
                    </div>
                    <span class="chat-username">{{ m.username || 'Unknown' }}</span>
                  </div>

                  <div class="chat-text">
                    {{ m.text }}
                  </div>
                </li>
              </ul>
            </div>
          </div>

          <div v-else-if="gameState && gameState.stage === 'PROMPTS'"
               class="game-stage-wrapper">

            <div class="prompts-row">
              <div class="prompt-main">
                <div class="prompt-card">
                  <div class="lobby-header">
                    <img src="/static/quiplash-logo.png"
                         alt="Quiplash Logo"
                         class="game-logo small-logo">
                    <h3 class="lobby-title">PROMPT STAGE</h3>
                  </div>

                  <p class="lobby-subtitle">
                    Round {{ gameState.round }} ‚Äì write a funny prompt for others to answer.
                  </p>

                  <p class="lobby-text">
                    Think of a short setup that could lead to silly answers, for example:
                    *‚ÄúThe worst thing to say to your driving instructor‚Ä¶‚Äù*
                  </p>

                  <div class="form-group">
                    <textarea
                      class="form-control"
                      rows="4"
                      v-model="promptText"
                      placeholder="Type your prompt here..."
                    ></textarea>
                  </div>

                  <div class="form-group button-row">
                    <button
                      class="btn btn-primary"
                      :disabled="!promptText.trim()"
                      @click="submitPrompt"
                    >
                      Submit prompt
                    </button>
                    <small class="text-muted" style="margin-left: 0.5rem;">
                      You can usually submit at least one prompt per round.
                    </small>
                  </div>
                </div>
              </div>

              <div class="prompt-side">
                <div class="status-card">
                  <h4 class="chat-title">Stage &amp; Players</h4>

                  <p class="status-subtitle">
                    Stage: **{{ gameState.stage }}**<br>
                    <span v-if="gameState.round">Round {{ gameState.round }}</span>
                  </p>

                  <p class="status-subtitle">
                    Players in this game:
                  </p>

                  <ul class="status-list"
                      v-if="gameState.players && gameState.players.length">
                    <li v-for="p in gameState.players"
                        :key="p.id"
                        class="status-item">
                      <span class="status-name">
                        {{ p.username }}
                        <span v-if="p.isAdmin">üëë</span>
                        <span v-if="p.username === username"> (you)</span>
                      </span>

                      <div class="status-scores">
                        <small>
                          Round: {{ p.roundScore || 0 }} ¬∑ Total: {{ p.score || 0 }}
                        </small>
                      </div>

                      <span class="status-pill"
                            :class="{
                              'status-waiting': p.status !== 'PROMPT_SUBMITTED',
                              'status-done': p.status === 'PROMPT_SUBMITTED'
                            }">
                        <span v-if="p.status === 'PROMPT_SUBMITTED'">Prompt submitted</span>
                        <span v-else>Waiting‚Ä¶</span>
                      </span>
                    </li>
                  </ul>


                  <p v-else class="status-empty">
                    No players found yet.
                  </p>

                  <div class="lobby-list" v-if="gameState.audience && gameState.audience.length" style="margin-top: 10px;">
                    <h5 class="lobby-list-title">
                      Audience ({{ gameState.audience.length }})
                    </h5>
                    <ul class="lobby-list-ul">
                      <li v-for="a in gameState.audience" :key="a.id">
                        <span class="lobby-player-name">
                          {{ a.username }}
                        </span>
                      </li>
                    </ul>
                  </div>
                  <div v-if="isAdmin" class="lobby-admin-controls" style="margin-top: 10px;">
                    <button class="btn btn-primary" @click="next">
                      Next &rarr; Answers
                    </button>
                    <p class="admin-hint">
                      Press this once everyone has submitted a prompt.
                    </p>
                  </div>
                </div>
              </div>
            </div>

            <div class="prompts-chat-row">
              <div class="chat-card">
                <h4 class="chat-title">Game Chat</h4>

                <div class="form-group">
                  <input type="text"
                         @keyup.enter="chat()"
                         v-model="chatmessage"
                         class="form-control"
                         placeholder="Type a message and press Enter">
                </div>

                <div class="form-group">
                  <button class="btn btn-primary" @click="chat">Send</button>
                </div>

                <ul id="chat">
                  <li v-for="(m, idx) in messages"
                      :key="idx"
                      :class="['chat-message', { 'my-message': m.username === username }]">

                    <div class="chat-header">
                      <div class="chat-avatar">
                        {{ (m.username || '?')[0].toUpperCase() }}
                      </div>
                      <span class="chat-username">{{ m.username || 'Unknown' }}</span>
                    </div>

                    <div class="chat-text">
                      {{ m.text }}
                    </div>
                  </li>
                </ul>
              </div>
            </div>

          </div>

          <div v-else-if="gameState && gameState.stage === 'ANSWERS'"
               class="game-stage-wrapper">

            <div class="prompts-row">
              <div class="prompt-main">
                <div class="prompt-card">
                  <div class="lobby-header">
                    <img src="/static/quiplash-logo.png"
                         alt="Quiplash Logo"
                         class="game-logo small-logo">
                    <h3 class="lobby-title">ANSWER STAGE</h3>
                  </div>

          <div v-if="myPlayer && myPlayer.assignedPrompts && myPlayer.assignedPrompts.length">
            <p class="lobby-subtitle">
              You have {{ myPlayer.assignedPrompts.length }} prompt<span v-if="myPlayer.assignedPrompts.length > 1">s</span> to answer.
            </p>

            <div
              v-for="ap in myPlayer.assignedPrompts"
              :key="ap.id"
              class="answer-card"
              style="margin-bottom: 16px; border-top: 1px solid rgba(148,163,184,0.3); padding-top: 10px;"
            >
              <p class="lobby-subtitle">
                Prompt:
              </p>
              <p class="lobby-text">
                **__{{ ap.text }}__**
              </p>

              <div class="form-group">
                <textarea
                  class="form-control"
                  rows="3"
                  v-model="answersDraft[ap.id]"
                  :placeholder="'Type your answer for this prompt...'"
                ></textarea>
              </div>

              <div class="form-group button-row">
                <button
                  class="btn btn-primary"
                  :disabled="!answersDraft[ap.id] || !answersDraft[ap.id].trim()"
                  @click="submitAnswer(ap.id)"
                >
                  Submit answer
                </button>
              </div>
            </div>
          </div>

                  <div v-else>
                    <p class="lobby-subtitle">
                      Waiting for the players to input their answers...
                    </p>
                    <p class="lobby-text" v-if="myPlayer">
                      The host has moved to the answer stage, but you haven't been assigned any prompts this round.
                    </p>
                  </div>
                </div>
              </div>

              <div class="prompt-side">
                <div class="status-card">
                  <h4 class="chat-title">Players</h4>

                  <p class="status-subtitle">
                    Stage: **{{ gameState.stage }}**<br>
                    <span v-if="gameState.round">Round {{ gameState.round }}</span>
                  </p>

              <ul class="status-list"
                  v-if="gameState.players && gameState.players.length">
                <li v-for="p in gameState.players"
                    :key="p.id"
                    class="status-item">
                  <span class="status-name">
                    {{ p.username }}
                    <span v-if="p.isAdmin">üëë</span>
                    <span v-if="p.username === username"> (you)</span>
                  </span>

                  <div class="status-scores">
                    <small>
                      Round: {{ p.roundScore || 0 }} ¬∑ Total: {{ p.score || 0 }}
                    </small>
                  </div>

                  <span class="status-pill"
                        :class="{
                          'status-waiting': p.status !== 'ANSWER_SUBMITTED',
                          'status-done': p.status === 'ANSWER_SUBMITTED'
                        }">
                    <span v-if="p.status === 'ANSWER_SUBMITTED'">
                      Answer submitted
                    </span>
                    <span v-else>
                      Waiting‚Ä¶
                    </span>
                  </span>
                </li>
              </ul>


                  <p v-else class="status-empty">
                    No players found yet.
                  </p>

                  <div class="lobby-list" v-if="gameState.audience && gameState.audience.length" style="margin-top: 10px;">
                    <h5 class="lobby-list-title">
                      Audience ({{ gameState.audience.length }})
                    </h5>
                    <ul class="lobby-list-ul">
                      <li v-for="a in gameState.audience" :key="a.id">
                        <span class="lobby-player-name">
                          {{ a.username }}
                        </span>
                      </li>
                    </ul>
                  </div>
                  <div v-if="isAdmin" class="lobby-admin-controls" style="margin-top: 10px;">
                    <button class="btn btn-primary" @click="next">
                      Next &rarr; Voting
                    </button>
                    <p class="admin-hint">
                      Press this once everyone has submitted an answer.
                    </p>
                  </div>

                </div>
              </div>
            </div>

            <div class="prompts-chat-row">
              <div class="chat-card">
                <h4 class="chat-title">Game Chat</h4>

                <div class="form-group">
                  <input type="text"
                         @keyup.enter="chat()"
                         v-model="chatmessage"
                         class="form-control"
                         placeholder="Type a message and press Enter">
                </div>

                <div class="form-group">
                  <button class="btn btn-primary" @click="chat">Send</button>
                </div>

                <ul id="chat">
                  <li v-for="(m, idx) in messages"
                      :key="idx"
                      :class="['chat-message', { 'my-message': m.username === username }]">

                    <div class="chat-header">
                      <div class="chat-avatar">
                        {{ (m.username || '?')[0].toUpperCase() }}
                      </div>
                      <span class="chat-username">{{ m.username || 'Unknown' }}</span>
                    </div>
                    

                    <div class="chat-text">
                      {{ m.text }}
                    </div>
                  </li>
                </ul>
              </div>
            </div>

          </div>

 <div v-else-if="gameState && gameState.stage === 'VOTING'"
     class="game-stage-wrapper">

  <div class="prompts-row">

    <div class="prompt-main">
      <div class="lobby-card">
        <div class="lobby-header">
          <img src="/static/quiplash-logo.png"
               alt="Quiplash Logo"
               class="game-logo small-logo">
          <h3 class="lobby-title">VOTING</h3>
        </div>

        <p class="lobby-subtitle">
          Time to vote!
        </p>

        <p class="lobby-text">
          Tap the best answer for each prompt. You **cannot** vote for your own answer.
        </p>

        <div v-if="gameState.activePrompts && gameState.activePrompts.length">
          <div
            v-for="prompt in gameState.activePrompts"
            :key="prompt.id"
            style="margin-bottom: 1rem; padding-bottom: 0.75rem; border-bottom: 1px solid rgba(148,163,184,0.4);"
          >
            <p class="lobby-subtitle">
              Prompt #{{ prompt.id + 1 }}:
            </p>
            <p class="lobby-text">
              **___{{ prompt.text }}_**<br>
              <small class="text-muted">
                (Written by {{ prompt.author }})
              </small>
              <span v-if="myPlayer && myPlayer.votesCast && myPlayer.votesCast[prompt.id] !== undefined"
                    class="text-success small"
                    style="margin-left: 0.5rem;">
                (Voted)
              </span>
            </p>

            <ul class="lobby-list-ul">
              <li
                v-for="pl in gameState.players"
                :key="'answer-' + prompt.id + '-' + pl.id"
                v-if="pl.answers && pl.answers[prompt.id]"
                style="margin-bottom: 6px;"
              >
                <template v-if="pl.username === username">
                  <span style="font-weight: bold;">
                    (Your answer)
                  </span>
                  &nbsp;{{ pl.answers[prompt.id] }}
                </template>

                <template v-else>
                  <button
                    v-if="!myPlayer || !myPlayer.votesCast || myPlayer.votesCast[prompt.id] === undefined"
                    class="btn btn-primary"
                    @click="castVote(prompt.id, pl.username)"
                  >
                    {{ pl.answers[prompt.id] }}
                  </button>

                  <span v-else>
                    {{ pl.answers[prompt.id] }}
                  </span>
                </template>
              </li>
            </ul>
            </div>
        </div>

        <p v-else class="status-empty">
          No prompts available for voting yet.
        </p>

        <div class="form-group button-row" style="margin-top: 1rem;">
          <button
            class="btn btn-primary"
            v-if="isAdmin"
            @click="next"
          >
            Finish voting / Next
          </button>
          <small class="text-muted" v-if="!isAdmin">
            Only the host‚Äôs button press actually advances the game.
          </small>
        </div>
      </div>
    </div>

    <div class="prompt-side">
      <div class="status-card">
        <h4 class="chat-title">Voting Status</h4>

        <p class="status-subtitle">
          Stage: **{{ gameState.stage }}**<br>
          <span v-if="gameState.round">Round {{ gameState.round }}</span>
        </p>

        <p class="status-subtitle">
          Players in this game:
        </p>

        <ul class="status-list"
            v-if="gameState.players && gameState.players.length">
          <li v-for="p in gameState.players"
              :key="p.id"
              class="status-item">
            <span class="status-name">
              {{ p.username }}
              <span v-if="p.isAdmin">üëë</span>
              <span v-if="p.username === username"> (you)</span>
            </span>

            <div class="status-scores">
              <small>
                Round: {{ p.roundScore || 0 }} ¬∑ Total: {{ p.score || 0 }}
              </small>
            </div>

            <span class="status-pill"
                  :class="{
                    'status-waiting': !p.votesCast || Object.keys(p.votesCast).length < gameState.activePrompts.length,
                    'status-done': p.votesCast && Object.keys(p.votesCast).length === gameState.activePrompts.length
                  }">
              <span v-if="p.votesCast && gameState.activePrompts.length">
                Votes: {{ Object.keys(p.votesCast).length }} / {{ gameState.activePrompts.length }}
              </span>
              <span v-else>
                Waiting‚Ä¶
              </span>
            </span>
          </li>
        </ul>


        <p v-else class="status-empty">
          No players found yet.
        </p>

        <div class="lobby-list" v-if="gameState.audience && gameState.audience.length" style="margin-top: 10px;">
          <h5 class="lobby-list-title">
            Audience ({{ gameState.audience.length }})
          </h5>
          <ul class="lobby-list-ul">
            <li v-for="a in gameState.audience" :key="a.id">
              <span class="lobby-player-name">
                {{ a.username }}
              </span>
            </li>
          </ul>
        </div>
        </div>
    </div>
  </div>

  <div class="prompts-chat-row">
    <div class="chat-card">
      <h4 class="chat-title">Game Chat</h4>

      <div class="form-group">
        <input type="text"
               @keyup.enter="chat()"
               v-model="chatmessage"
               class="form-control"
               placeholder="Type a message and press Enter">
      </div>

      <div class="form-group">
        <button class="btn btn-primary" @click="chat">Send</button>
      </div>

      <ul id="chat">
        <li v-for="(m, idx) in messages"
            :key="idx"
            :class="['chat-message', { 'my-message': m.username === username }]">

          <div class="chat-header">
            <div class="chat-avatar">
              {{ (m.username || '?')[0].toUpperCase() }}
            </div>
            <span class="chat-username">{{ m.username || 'Unknown' }}</span>
          </div>

          <div class="chat-text">
            {{ m.text }}
          </div>
        </li>
      </ul>
    </div>
  </div>

</div>

          <div v-else-if="gameState && gameState.stage === 'SCORING'"
               class="game-stage-wrapper">

            <div class="lobby-card">
              <div class="lobby-header">
                <img src="/static/quiplash-logo.png"
                     alt="Quiplash Logo"
                     class="game-logo small-logo">
                <h3 class="lobby-title">ROUND {{ gameState.round }} SCORES</h3>
              </div>

              <p class="lobby-subtitle">
                Round {{ gameState.round }} results
              </p>

              <ul class="lobby-list-ul"
                  v-if="gameState.players && gameState.players.length">
                <li v-for="p in gameState.players"
                    :key="p.id"
                    class="status-item">
                  <span class="status-name">
                    #{{ p.rank || '?' }} ¬∑ {{ p.username }}
                    <span v-if="p.isAdmin">üëë</span>
                    <span v-if="p.username === username"> (you)</span>
                  </span>
                  <div class="status-scores">
                    <small>
                      This round: {{ p.roundScore || 0 }} ¬∑ Total: {{ p.score || 0 }}
                    </small>
                  </div>
                </li>
              </ul>

              <p v-else class="status-empty">
                No players found.
              </p>

              <div class="lobby-list" v-if="gameState.audience && gameState.audience.length" style="margin-top: 10px;">
                <h5 class="lobby-list-title">
                  Audience ({{ gameState.audience.length }})
                </h5>
                <ul class="lobby-list-ul">
                  <li v-for="a in gameState.audience" :key="a.id">
                    <span class="lobby-player-name">
                      {{ a.username }}
                    </span>
                  </li>
                </ul>
              </div>
              <div class="form-group button-row" style="margin-top: 1rem;">
                <button class="btn btn-primary" v-if="isAdmin" @click="next">
                  <span v-if="gameState.round < 3">
                    Start next round
                  </span>
                  <span v-else>
                    Finish game
                  </span>
                </button>
                <small class="text-muted" v-if="!isAdmin">
                  Waiting for the host to continue.
                </small>
              </div>
            </div>

            <div class="chat-card">
              <h4 class="chat-title">Game Chat</h4>

              <div class="form-group">
                <input type="text"
                       @keyup.enter="chat()"
                       v-model="chatmessage"
                       class="form-control"
                       placeholder="Type a message and press Enter">
              </div>

              <div class="form-group">
                <button class="btn btn-primary" @click="chat">Send</button>
              </div>

              <ul id="chat">
                <li v-for="(m, idx) in messages"
                    :key="idx"
                    :class="['chat-message', { 'my-message': m.username === username }]">
                  <div class="chat-header">
                    <div class="chat-avatar">
                      {{ (m.username || '?')[0].toUpperCase() }}
                    </div>
                    <span class="chat-username">{{ m.username || 'Unknown' }}</span>
                  </div>
                  <div class="chat-text">
                    {{ m.text }}
                  </div>
                </li>
              </ul>
            </div>
          </div>

          <div v-else-if="gameState && gameState.stage === 'GAME_OVER'"
               class="game-stage-wrapper">

            <div class="lobby-card">
              <div class="lobby-header">
                <img src="/static/quiplash-logo.png"
                     alt="Quiplash Logo"
                     class="game-logo small-logo">
                <h3 class="lobby-title">GAME OVER</h3>
              </div>

              <p class="lobby-subtitle">
                Final leaderboard after {{ gameState.round }} rounds
              </p>

              <ul class="lobby-list-ul"
                  v-if="gameState.players && gameState.players.length">
                <li v-for="p in gameState.players"
                    :key="p.id"
                    class="status-item">
                  <span class="status-name">
                    #{{ p.rank || '?' }} ¬∑ {{ p.username }}
                    <span v-if="p.isAdmin">üëë</span>
                    <span v-if="p.username === username"> (you)</span>
                  </span>
                  <div class="status-scores">
                    <small>
                      Total score: {{ p.score || 0 }}
                    </small>
                  </div>
                </li>
              </ul>

              <p v-else class="status-empty">
                No players found.
              </p>

              <div class="lobby-list" v-if="gameState.audience && gameState.audience.length" style="margin-top: 10px;">
                <h5 class="lobby-list-title">
                  Audience ({{ gameState.audience.length }})
                </h5>
                <ul class="lobby-list-ul">
                  <li v-for="a in gameState.audience" :key="a.id">
                    <span class="lobby-player-name">
                      {{ a.username }}
                    </span>
                  </li>
                </ul>
              </div>
              <p class="lobby-text" style="margin-top: 1rem;">
                Refresh the page to start a fresh game.
              </p>
            </div>

            <div class="chat-card">
              <h4 class="chat-title">Game Chat</h4>

              <div class="form-group">
                <input type="text"
                       @keyup.enter="chat()"
                       v-model="chatmessage"
                       class="form-control"
                       placeholder="Type a message and press Enter">
              </div>

              <div class="form-group">
                <button class="btn btn-primary" @click="chat">Send</button>
              </div>

              <ul id="chat">
                <li v-for="(m, idx) in messages"
                    :key="idx"
                    :class="['chat-message', { 'my-message': m.username === username }]">
                  <div class="chat-header">
                    <div class="chat-avatar">
                      {{ (m.username || '?')[0].toUpperCase() }}
                    </div>
                    <span class="chat-username">{{ m.username || 'Unknown' }}</span>
                  </div>
                  <div class="chat-text">
                    {{ m.text }}
                  </div>
                </li>
              </ul>
            </div>
          </div>


          <div v-else class="game-stage-wrapper">
            <div class="lobby-card">
              <div class="lobby-header">
                <img src="/static/quiplash-logo.png"
                     alt="Quiplash Logo"
                     class="game-logo small-logo">
                <h3 class="lobby-title">Game in progress</h3>
              </div>
              <p class="lobby-subtitle">
                Current stage: **{{ gameState && gameState.stage }}**
              </p>
              <p class="lobby-text">
                You can add custom UIs here later for VOTING, RESULTS, SCORES and GAME_OVER.
              </p>
            </div>

            <div class="chat-card">
              <h4 class="chat-title">Game Chat</h4>

              <div class="form-group">
                <input type="text"
                       @keyup.enter="chat()"
                       v-model="chatmessage"
                       class="form-control"
                       placeholder="Type a message and press Enter">
              </div>

              <div class="form-group">
                <button class="btn btn-primary" @click="chat">Send</button>
              </div>

              <ul id="chat">
                <li v-for="(m, idx) in messages"
                    :key="idx"
                    :class="['chat-message', { 'my-message': m.username === username }]">
                  <div class="chat-header">
                    <div class="chat-avatar">
                      {{ (m.username || '?')[0].toUpperCase() }}
                    </div>
                    <span class="chat-username">{{ m.username || 'Unknown' }}</span>
                  </div>
                  <div class="chat-text">
                    {{ m.text }}
                  </div>
                </li>
              </ul>
            </div>
          </div>

        </div>

      </div>

      <div v-else class="auth-wrapper">
        <div class="auth-card">
          <p class="message-text error-text">
            Not connected to the server. Attempting to reconnect...
          </p>
        </div>
      </div>
    </div>
  </div>

  <%- include('footer'); -%>

</html>